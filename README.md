# Poll API server demo

### This server accepts REST API calls and manipulates objects (Polls, Questions, Options, Answers)

![alt text](db_diagram.jpg)

## Requirements:
- Python == 3.8
- Django == 2.2
- DRF == *
- psycopg2 <= 2.8
- Pipenv
- Postgres


## Quick start:
1. Clone this project:
`git clone https://github.com/KarlosAndresson/poll-api-server.git`
2. Open created folder `poll-api-server`
3. Create folder for virtual environment: `mkdir .venv`
4. Run `pipenv shell`
5. Run `pipenv update`
6. Make new secret key for Django: 

`python3 -c 'from django.core.management.utils import get_random_secret_key; 
print(get_random_secret_key())'`

or

`python3 -c 'import secrets; print(secrets.token_urlsafe())'`
7. Add following environment variables and put secret key, change DB settings to yours: 

`export DJANGO_SETTINGS_MODULE=polls.settings;export F_SECRET_KEY="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";export F_ALLOWED_HOSTS=localhost,127.0.0.1;export F_DEBUG=True;export F_DB_HOST=127.0.0.1;export F_DB_PORT=5432;export F_DB_NAME=test;export F_DB_USER=test;export F_DB_PASSWORD=test;`
8. Make initial migrations:
`python3 manage.py makemigrations`
9. Run migrations:
`python3 manage.py migrate`
10. Create superuser:
`python3 manage.py createsuperuser`
11. Start server with command:
`python3 manage.py runserver`
12. Open [http://localhost:8000/api/v1/](http://localhost:8000/api/v1/)
13. Samples of API requests located in folder `tests`
14. For some operations (create, change, delete Polls, Questions, Options) you will need token of superuser, which can be generated in [Admin area](http://localhost:8000/admin/authtoken/). Authorization header prefix is "Bearer".


## API usage
Autogenerated API docs available here: [http://localhost:8000/api/v1/](http://localhost:8000/api/v1/)

Examples for ordinary user:

1. Get list of active pools:
```
GET http://localhost:8000/api/v1/polls/?is_active=True
Content-Type: application/json
```

2. Send answer:
```
POST http://localhost:8000/api/v1/answers/
Content-Type: application/json

{
  "user" : 1,
  "option" : 1,
  "text" : "Тест",
  "options" : []
}
```

3. Get polls which has answers of specified user:
```
GET http://localhost:8000/api/v1/polls/?user=1
Content-Type: application/json
```

Examples for administrators:

1. Authorization/Authentication via token of superuser:
```
DELETE http://localhost:8000/api/v1/polls/3/
Content-Type: application/json
Authorization: Bearer b9ec7df54b01332df917affbea83a0c03aba4b66
```

2. Adding, modifying, deletion of polls:
```
POST http://localhost:8000/api/v1/polls/ HTTP/1.1
Content-Type: application/json
Authorization: Bearer b9ec7df54b01332df917affbea83a0c03aba4b66

{
  "name" : "Опрос №1",
  "started_at" : "2021.08.04 23:16:10+03:00",
  "description" : "Пример создания опроса",
  "is_active" : "True",
  "questions" : []
}
```
Note: field "started_at" prohibited to be changed after creation

3. Adding, modifying, deletion of question in polls:
```
PATCH http://localhost:8000/api/v1/questions/2/
Content-Type: application/json
Authorization: Bearer b9ec7df54b01332df917affbea83a0c03aba4b66

{
 "description" : "Вопрос на засыпку №1"
}
```
Note: allowed question types are: 'TEXT', 'RADIO', 'CHECK'


## TODO
- to make answer changing instead of creating new one for same question
- to account question type during answer acceptance (i.e. 'RADIO' should not take more than 1 answer)